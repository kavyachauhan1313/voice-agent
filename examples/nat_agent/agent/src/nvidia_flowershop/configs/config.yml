# SPDX-FileCopyrightText: Copyright (c) 2024-2025, NVIDIA CORPORATION & AFFILIATES. All rights reserved.
# SPDX-License-Identifier: Apache-2.0
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
general:
  use_uvloop: true
  telemetry:
    tracing:
      phoenix:
        _type: phoenix
        endpoint: http://0.0.0.0:6006/v1/traces
        project: voice_assistant
    logging:
      console:
        _type: console
        level: WARN
      file:
        _type: file
        path: /tmp/flowers_shop_demo.log
        level: DEBUG
functions:
  get_menu:
    _type: get_menu
    file_path: "menu.json"  # You can change this to any path you want
    natural_phrases:
      - "Let me check the menu for you."
      - "Sure, let me pull up the full menu."
      - "Alright, lets see what we have got today."
  get_price:
    _type: get_price
    file_path: "menu.json"  # You can change this to any path you want
    natural_phrases:
      - "Let me check the price for you."
      - "Sure, checking what that costs."
      - "Alright, lets get the price for that one."
  add_to_cart:
    _type: add_to_cart
    file_path: "menu.json"
    natural_phrases:
      - "Let me add that to your cart."
      - "Alright, I have added it to your cart."
      - "Sure thing, adding to your cart."
  remove_from_cart:
    _type: remove_from_cart
    file_path: "menu.json"
    natural_phrases:
      - "Let me remove that from your cart."
      - "Alright, removing from your cart."
      - "Sure, taking it out of your cart."
  clear_cart:
    _type: clear_cart
    natural_phrases:
      - "Alright, clearing your cart."
      - "Emptying your cart."
      - "Ok, removing everything from your cart."
  view_cart:
    _type: view_cart
    file_path: "menu.json"
    natural_phrases:
      - "Let me show you what's in your cart."
      - "Alright, let me check your cart."
      - "Lets see what you have got so far."
llms:
  nim_llm:
    _type: nim
    base_url: "http://0.0.0.0:8080"
    model_name: meta/llama-3.1-70b-instruct
    temperature: 0.0
  openai_llm:
    _type: openai
    model_name: gpt-3.5-turbo
    max_tokens: 2000
workflow:
  _type: rewoo_agent
  tool_names:
    - get_menu
    - get_price
    - add_to_cart
    - remove_from_cart
    - clear_cart
    - view_cart
  llm_name: nim_llm
  verbose: true
  retry_parsing_errors: true
  max_retries: 1
  additional_instructions: |
    "### ORDER OF TASKS"
    "1. Recommend something from the menu"
    "2. Ask if the user wants to add anything to the cart"
    "3. Give the total price of the cart and ask if user wants to proceed with the order"
    "4. If user wants to proceed, ask for delivery address and delivery time"
    "5. If user wants to cancel the order, ask for the reason and clear the cart"
    "6. If user wants to proceed and you have delivery address and delivery time, ask for the payment method"
    "7. After payment, confirm the order and thank the user for the order"
    "### CONVERSATION CONSTRAINTS"
    "STRICTLY answer in 1-2 sentences or less than 200 characters. This must be followed very rigorously; it is crucial."
    "Output must be plain text, unformatted, and without any special characters - suitable for direct conversion to speech."
    "DO NOT use bullet points, lists, code samples, or headers in your spoken responses."
    "STRICTLY be short, concise, and to the point. Avoid elaboration, explanation, or repetition."
    "Pronounce numbers, dates, and special terms. For phone numbers, read digits slowly and separately. For times, use natural phrasing like 'seven o'clock a.m.' instead of 'seven zero zero.'"
    "Silently correct likely transcription errors by inferring the intended meaning from  without saying `did you mean..` or `I think you meant..`. Prioritize what the user meant, not just the literal words."
    "### OPENING PROTOCOL:- STRICTLY START CONVERSATION WITH 'Thank you for calling GreenForce Garden. What can I do for you today?''"
    "### CLOSING PROTOCOL:- End with either 'Have a green day!' or 'Have a good one.' Use one consistently per call."
    "### YOU ARE ..."
    "You are Flora, the voice of 'GreenForce Garden', a San Francisco flower shop powered by NVIDIA GPUs."
    "You're cool, upbeat, and love making people smile with your floral know-how."
    "You embody warmth, expertise, and dedication to creating a perfect floral experience."
    "### CONVERSATION GUIDELINES"
    "CORE RESPONSIBILITIES- Order Management, Consultation, Inventory Guidance, Delivery Coordination, Customer Care, Giving Fun Advice"
    "While taking orders, have occasion understanding, ask for recipient details, customer preferences, and delivery planning"
    "STRICTLY Collect complete contact information for order updates"
    "SUGGEST cards with personal messages"
    "SUGGEST seasonal recommendations (e.g., spring: tulips, pastels; romance: roses, peonies) and occasion-specific details (e.g., elegant wrapping)."
    "SUGGEST complementary items: vases, chocolates, cards. Also provide care instructions for long-lasting enjoyment."
    "STRICTLY Confirm all order details before finalizing: flowers, colors, delivery address, timing"
    "STRICTLY Provide ORDER CONFIRMATION with ESTIMATED DELIVERY TIMES"
    "Offer MULTIPLE PAYMENT OPTIONS (e.g., card, cash, online) and confirm SECURE PROCESSING."
    "STRICTLY If you are unsure about a request, ask clarifying questions to ensure you understand before responding."
  profiler:
    token_uniqueness_forecast: true
    workflow_runtime_forecast: true
    compute_llm_metrics: true
    prompt_caching_prefixes:
      enable: true
      min_frequency: 0.1
    bottleneck_analysis:
      # Can also be simple_stack
      enable_nested_stack: true
    concurrency_spike_analysis:
      enable: true
      spike_threshold: 7
eval:
  general:
    output_dir: .tmp/aiq/examples/nvidia_flowershop/flower_shop/eval
    verbose: true
    dataset:
      _type: json
      file_path: examples/basic/functions/nvidia_flowershop/data/flower_shop_demo.json
      id_key: "id"
      structure:
        question_key: "question"
        answer_key: "answer"
  profiler:
    token_uniqueness_forecast: true
    workflow_runtime_forecast: true
    compute_llm_metrics: true
    prompt_caching_prefixes:
      enable: true
      min_frequency: 0.1
    bottleneck_analysis:
      # Can also be simple_stack
      enable_nested_stack: true
    concurrency_spike_analysis:
      enable: true
      spike_threshold: 7
  evaluators:
    rag_accuracy:
      _type: ragas
      metric: AnswerAccuracy
      llm_name: nim_rag_eval_llm
    rag_groundedness:
      _type: ragas
      metric: ResponseGroundedness
      llm_name: nim_rag_eval_llm
